console.log("ğŸš€ Background Service Worker started");const r={watchingTabIds:new Set,requests:new Map};function a(e){r.watchingTabIds.add(e),console.log(`ğŸ“¡ Started monitoring Tab ${e}`)}function c(e){r.watchingTabIds.delete(e),r.requests.delete(e),console.log(`ğŸ”´ Stopped monitoring Tab ${e}`)}function d(e){r.requests.delete(e),console.log(`ğŸ§¹ Cleared requests for Tab ${e}`)}chrome.webRequest.onBeforeRequest.addListener(e=>{if(!r.watchingTabIds.has(e.tabId))return;const t={requestId:e.requestId,url:e.url,method:e.method,type:e.type,timeStamp:e.timeStamp,requestBody:e.requestBody??void 0};r.requests.has(e.tabId)||r.requests.set(e.tabId,[]),r.requests.get(e.tabId).push(t),console.log(`ğŸŒ [Tab ${e.tabId}] ${e.method} ${e.url}`),chrome.runtime.sendMessage({type:"NETWORK_REQUEST",target:"sidepanel",tabId:e.tabId,request:t}).catch(()=>{})},{urls:["<all_urls>"]},["requestBody"]);chrome.webRequest.onCompleted.addListener(e=>{r.watchingTabIds.has(e.tabId)&&(console.log(`âœ… [Tab ${e.tabId}] Completed ${e.statusCode} ${e.url}`),chrome.runtime.sendMessage({type:"NETWORK_COMPLETED",target:"sidepanel",tabId:e.tabId,requestId:e.requestId,statusCode:e.statusCode,url:e.url}).catch(()=>{}))},{urls:["<all_urls>"]});chrome.webRequest.onErrorOccurred.addListener(e=>{r.watchingTabIds.has(e.tabId)&&(console.log(`âŒ [Tab ${e.tabId}] Error ${e.error} ${e.url}`),chrome.runtime.sendMessage({type:"NETWORK_ERROR",target:"sidepanel",tabId:e.tabId,requestId:e.requestId,error:e.error,url:e.url}).catch(()=>{}))},{urls:["<all_urls>"]});chrome.action.onClicked.addListener(e=>{console.log("ğŸ–±ï¸ Extension icon clicked",e),e.windowId&&chrome.sidePanel.open({windowId:e.windowId})});chrome.runtime.onInstalled.addListener(()=>{console.log("âœ… Extension installed/updated"),chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0})});chrome.runtime.onMessage.addListener((e,t,o)=>{var n;if(e.type==="ELEMENT_UPDATE"||e.type==="CONTENT_SCRIPT_READY"){const s={...e,tabId:(n=t.tab)==null?void 0:n.id,target:"sidepanel"};u(s)}return e.type==="START_NETWORK_MONITOR"&&(a(e.tabId),o({success:!0})),e.type==="STOP_NETWORK_MONITOR"&&(c(e.tabId),o({success:!0})),e.type==="CLEAR_NETWORK_REQUESTS"&&(d(e.tabId),o({success:!0})),!1});async function u(e){try{const t=await chrome.windows.getAll();for(const o of t)chrome.runtime.sendMessage({...e,target:"sidepanel"}).catch(()=>{})}catch{}}chrome.tabs.onUpdated.addListener((e,t,o)=>{(t.status==="complete"||t.url)&&chrome.runtime.sendMessage({type:"TAB_UPDATED",target:"sidepanel",tabId:e,changeInfo:t,tab:o}).catch(()=>{})});chrome.tabs.onCreated.addListener(e=>{console.log("Tab created",e),chrome.runtime.sendMessage({type:"TAB_CREATED",target:"sidepanel",tab:e}).catch(()=>{})});chrome.tabs.onRemoved.addListener((e,t)=>{console.log("Tab removed",e,t),chrome.runtime.sendMessage({type:"TAB_REMOVED",target:"sidepanel",tabId:e,removeInfo:t}).catch(()=>{})});

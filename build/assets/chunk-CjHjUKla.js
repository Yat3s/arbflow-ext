const s="https://arbflow.io",i=`${s}/extension/bridge`;async function o(){const e=await chrome.storage.local.get(["accessToken","expiresAt","user"]);return{accessToken:e.accessToken||null,expiresAt:e.expiresAt||null,user:e.user||null}}async function r(e){await chrome.storage.local.set(e)}async function u(){await chrome.storage.local.remove(["accessToken","expiresAt","user"])}async function h(){const e=await o();return!e.accessToken||!e.expiresAt?!1:Date.now()<e.expiresAt}async function l(e){const t=await fetch(`${s}/api/extension/exchange`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(!t.ok){const n=await t.text();throw new Error(`Failed to exchange code: ${n}`)}const a=await t.json();return{accessToken:a.access_token,expiresAt:a.expires_at}}async function c(e){const t=await fetch(`${s}/api/extension/me`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch user info");return(await t.json()).user}function f(){return chrome.tabs.create({url:i})}async function w(e){const{accessToken:t,expiresAt:a}=await l(e),n=await c(t);await r({accessToken:t,expiresAt:a,user:n})}async function p(){await u()}async function x(){const e=await o();if(!e.accessToken)return null;try{const t=await c(e.accessToken);return await r({user:t}),t}catch(t){return console.error("Failed to refresh user info:",t),null}}export{o as g,w as h,h as i,p as l,f as o,x as r};
